<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalle de env√≠o</title>
    <link rel="stylesheet" href="styles-envio.css" />
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <style>
        /* Estilos espec√≠ficos de esta vista */
        .container {
            max-width: 960px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .shipment-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .08);
            padding: 24px;
            display: grid;
            gap: 16px;
        }

        .shipment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px 16px;
        }

        .badge {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: .3px;
            background: #ffe680;
            color: #7a5a00;
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        .field {
            background: #fafafa;
            border-radius: 8px;
            padding: 12px 14px;
        }

        .field label {
            font-size: 12px;
            color: #666;
            display: block;
            margin-bottom: 6px;
        }

        .field div {
            font-size: 16px;
            font-weight: 600;
        }

        .actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #d40511;
            color: #d40511;
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all .2s ease;
        }

        .btn-outline:hover {
            background: #ffd6d8;
        }

        .note {
            font-size: 13px;
            color: #444;
            background: #fff9d6;
            border: 1px solid #ffe58f;
            padding: 10px 12px;
            border-radius: 6px;
        }


        /* ‚îÄ‚îÄ Eco options panel ‚îÄ‚îÄ */
        .eco-panel {
            display: none;
            margin-top: 16px;
            background: #f0faf0;
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 20px 22px;
            animation: slideDown .25s ease;
        }
        @keyframes slideDown {
            from { opacity:0; transform:translateY(-8px); }
            to   { opacity:1; transform:translateY(0); }
        }
        .eco-panel h3 {
            margin: 0 0 6px;
            font-size: 16px;
            color: #1b5e20;
        }
        .eco-panel p.eco-intro {
            margin: 0 0 16px;
            font-size: 13px;
            color: #444;
        }
        .delay-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 18px;
        }
        .delay-opt {
            cursor: pointer;
            border: 2px solid #c8e6c9;
            background: #fff;
            border-radius: 10px;
            padding: 12px 16px;
            text-align: center;
            transition: all .18s ease;
            min-width: 100px;
            flex: 1;
        }
        .delay-opt:hover {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        .delay-opt.selected {
            border-color: #2e7d32;
            background: #e8f5e9;
            box-shadow: 0 0 0 3px rgba(46,125,50,.15);
        }
        .delay-opt .opt-days {
            font-size: 18px;
            font-weight: 800;
            color: #2e7d32;
            display: block;
        }
        .delay-opt .opt-label {
            font-size: 11px;
            color: #666;
            display: block;
            margin-bottom: 6px;
        }
        .delay-opt .opt-pts {
            display: inline-block;
            background: #2e7d32;
            color: #fff;
            font-size: 11px;
            font-weight: 700;
            padding: 2px 9px;
            border-radius: 20px;
        }
        .eco-summary {
            display: none;
            background: #fff;
            border: 1px solid #c8e6c9;
            border-radius: 8px;
            padding: 14px 18px;
            margin-bottom: 16px;
            font-size: 14px;
            gap: 20px;
            flex-wrap: wrap;
        }
        .eco-summary.visible { display: flex; }
        .eco-sum-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .eco-sum-item span:first-child {
            font-size: 11px;
            color: #888;
            font-weight: 600;
            letter-spacing: .3px;
        }
        .eco-sum-item span:last-child {
            font-size: 16px;
            font-weight: 800;
            color: #1b5e20;
        }
        .btn-confirm-eco {
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: #fff;
            border: none;
            padding: 11px 26px;
            border-radius: 7px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: opacity .2s;
            width: 100%;
        }
        .btn-confirm-eco:disabled {
            opacity: .5;
            cursor: default;
        }
        .btn-confirm-eco:not(:disabled):hover { opacity: .88; }
        .eco-activated-msg {
            display: none;
            align-items: center;
            gap: 12px;
            background: #e8f5e9;
            border: 1px solid #a5d6a7;
            border-radius: 8px;
            padding: 14px 18px;
            font-size: 14px;
            color: #1b5e20;
            font-weight: 600;
        }
        .eco-activated-msg.visible { display: flex; }
        .eco-activated-msg .pts-pill {
            background: #2e7d32;
            color: #fff;
            border-radius: 20px;
            padding: 4px 14px;
            font-size: 15px;
            font-weight: 800;
            white-space: nowrap;
        }
    </style>
</head>

<body>

    <header>
        <div><a href="index.html" style="text-decoration:none;"><strong class="logo">HackatonDHL</strong></a></div>
        <nav>
            <a href="index.html">Haga seguimiento</a>
            <a href="#">Enviar</a>
            <a href="#">Servicios de log√≠stica</a>
            <a href="#">Servicio al cliente</a>
        </nav>
        <a href="profile.html" class="header-profile">
            <span class="header-avatar">CM</span>
            <span class="header-username">Carlos M.</span>
        </a>
    </header>

    <main class="container">
        <h1 style="margin: 10px 0 18px;">Detalle del env√≠o</h1>
        <h2 style="margin-top:40px;">Ubicaci√≥n del env√≠o</h2>
        <div id="map"></div>

        <section class="shipment-card" id="card">
            <div class="shipment-header">
                <div>
                    <div style="font-size:18px; font-weight:800;">Env√≠o #1234 5678 90</div>
                    <span class="badge" id="badge-servicio">Servicio: Est√°ndar</span>
                </div>
                <div class="actions">
                    <button class="btn-outline" id="btn-eco">üçÉ Cambiar a Env√≠oEco</button>
                    <a class="btn" href="index.html">Volver</a>
                </div>
            </div>

            <!-- ECO OPTIONS PANEL (hidden until button click) -->
            <div class="eco-panel" id="eco-panel">
                <h3>üåø Elige el retraso de tu Env√≠oEco</h3>
                <p class="eco-intro">Tus paquetes se acumular√°n con otros env√≠os cercanos para reducir emisiones. A mayor retraso que aceptes, m√°s EcoPoints ganar√°s.</p>

                <div class="delay-options" id="delay-options">
                    <div class="delay-opt" data-days="2" data-pts="80" onclick="selectDelay(this)">
                        <span class="opt-label">Retraso de</span>
                        <span class="opt-days">2 d√≠as</span>
                        <span class="opt-pts">+80 pts</span>
                    </div>
                    <div class="delay-opt" data-days="3" data-pts="120" onclick="selectDelay(this)">
                        <span class="opt-label">Retraso de</span>
                        <span class="opt-days">3 d√≠as</span>
                        <span class="opt-pts">+120 pts</span>
                    </div>
                    <div class="delay-opt" data-days="5" data-pts="200" onclick="selectDelay(this)">
                        <span class="opt-label">Retraso de</span>
                        <span class="opt-days">5 d√≠as</span>
                        <span class="opt-pts">+200 pts</span>
                    </div>
                    <div class="delay-opt" data-days="7" data-pts="340" onclick="selectDelay(this)">
                        <span class="opt-label">Retraso de</span>
                        <span class="opt-days">7 d√≠as</span>
                        <span class="opt-pts">+340 pts</span>
                    </div>
                </div>

                <!-- Summary row (appears when an option is selected) -->
                <div class="eco-summary" id="eco-summary">
                    <div class="eco-sum-item">
                        <span>NUEVA ENTREGA ESTIMADA</span>
                        <span id="sum-date">‚Äî</span>
                    </div>
                    <div class="eco-sum-item">
                        <span>RETRASO</span>
                        <span id="sum-delay">‚Äî</span>
                    </div>
                    <div class="eco-sum-item">
                        <span>ECOPOINTS A GANAR</span>
                        <span id="sum-pts">‚Äî</span>
                    </div>
                    <div class="eco-sum-item">
                        <span>CO‚ÇÇ AHORRADO</span>
                        <span id="sum-co2">‚Äî</span>
                    </div>
                </div>

                <button class="btn-confirm-eco" id="btn-confirm" disabled onclick="confirmEco()">Confirmar Env√≠oEco</button>

                <!-- Post-confirmation message -->
                <div class="eco-activated-msg" id="eco-activated">
                    <span>‚úÖ Env√≠oEco activado ¬∑ Tu nueva entrega llegar√° el <strong id="activated-date">‚Äî</strong></span>
                    <span class="pts-pill" id="activated-pts">‚Äî</span>
                </div>
            </div>

            <div class="row">
                <div class="field">
                    <label>Estado</label>
                    <div id="estado">En tr√°nsito</div>
                </div>
                <div class="field">
                    <label>Entrega estimada</label>
                    <div>Martes 25 de febrero, 12:00‚Äì16:00</div>
                </div>
            </div>

            <div class="row">
                <div class="field">
                    <label>Origen</label>
                    <div>Madrid, ES</div>
                </div>
                <div class="field">
                    <label>Destino</label>
                    <div>Barcelona, ES</div>
                </div>
            </div>

            <p class="note" id="nota">
                Este env√≠o usa el servicio Est√°ndar. Puedes cambiar a <strong>Env√≠oEco</strong> para reducir tu huella
                de carbono.
            </p>
        </section>
        <section class="impact-section" aria-labelledby="impact-title">
            <h2 id="impact-title">Impacto ambiental del env√≠o</h2>

            <div class="impact-summary">
                <div class="impact-item">
                    <span class="label">Emisiones estimadas</span>
                    <span class="value"><span id="co2-value">4.8</span> kg CO‚ÇÇe</span>
                </div>
                <div class="impact-item">
                    <span class="label">Ahorro con Env√≠oEco</span>
                    <span class="value saving">hasta <span id="saving-percent">40</span>%</span>
                </div>
            </div>

            <!-- Barra de progreso accesible -->
            <div class="impact-bar" role="progressbar" aria-valuemin="0" aria-valuemax="10" aria-valuenow="4.8"
                aria-label="Emisiones de CO2 del env√≠o">
                <div class="impact-bar__fill" id="impact-fill" style="width: 48%"></div>
            </div>

            <p class="impact-note" id="impact-note">
                Este env√≠o usa el servicio <strong>Est√°ndar</strong>. Cambia a <strong>Env√≠oEco</strong> para reducir
                las emisiones de CO‚ÇÇe.
            </p>
        </section>
    </main>

    <script>
        // ‚îÄ‚îÄ Eco panel toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const btnEcoBtn   = document.getElementById('btn-eco');
        const ecoPanel    = document.getElementById('eco-panel');

        btnEcoBtn.addEventListener('click', () => {
            if (btnEcoBtn.disabled) return;
            const isOpen = ecoPanel.style.display === 'block';
            ecoPanel.style.display = isOpen ? 'none' : 'block';
        });

        // ‚îÄ‚îÄ Delay option selection ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let selectedDays = null;
        let selectedPts  = null;

        // Base delivery date: Tuesday 25 Feb 2026
        const baseDelivery = new Date(2026, 1, 25); // month is 0-indexed

        function selectDelay(el) {
            document.querySelectorAll('.delay-opt').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');

            selectedDays = parseInt(el.dataset.days);
            selectedPts  = parseInt(el.dataset.pts);

            // Compute new date
            const newDate = new Date(baseDelivery);
            newDate.setDate(newDate.getDate() + selectedDays);
            const dateStr = newDate.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' });
            const dateStrCap = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);

            // CO2 saving estimate (40% base, scales slightly with days)
            const co2Base   = 4.8;
            const savingPct = Math.min(40 + (selectedDays - 2) * 2, 55);
            const co2Saved  = (co2Base * savingPct / 100).toFixed(1);

            // Update summary
            document.getElementById('sum-date').textContent  = dateStrCap;
            document.getElementById('sum-delay').textContent = `+${selectedDays} d√≠as`;
            document.getElementById('sum-pts').textContent   = `+${selectedPts} pts`;
            document.getElementById('sum-co2').textContent   = `‚àí${co2Saved} kg CO‚ÇÇ`;

            const summary = document.getElementById('eco-summary');
            summary.classList.add('visible');

            document.getElementById('btn-confirm').disabled = false;
        }

        // ‚îÄ‚îÄ Confirm ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function confirmEco() {
            const newDate = new Date(baseDelivery);
            newDate.setDate(newDate.getDate() + selectedDays);
            const dateStr = newDate.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' });
            const dateStrCap = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);

            // Disable options and confirm button
            document.querySelectorAll('.delay-opt').forEach(o => { o.style.pointerEvents = 'none'; o.style.opacity = '.6'; });
            document.querySelector('.delay-opt.selected').style.opacity = '1';
            document.getElementById('btn-confirm').disabled = true;

            // Show activation message
            document.getElementById('activated-date').textContent = dateStrCap;
            document.getElementById('activated-pts').textContent  = `+${selectedPts} üçÉ EcoPoints`;
            document.getElementById('eco-activated').classList.add('visible');

            // Update shipment card
            const badge   = document.getElementById('badge-servicio');
            const nota    = document.getElementById('nota');
            const estadoEl = document.getElementById('estado');
            if (badge) { badge.textContent = 'Servicio: Env√≠oEco'; badge.style.background = '#d9f7be'; badge.style.color = '#135200'; }
            if (estadoEl) estadoEl.textContent = 'En tr√°nsito (modo ecol√≥gico)';
            if (nota) nota.innerHTML = `Has activado <strong>Env√≠oEco</strong> con un retraso de <strong>${selectedDays} d√≠as</strong>. Ganar√°s <strong>+${selectedPts} EcoPoints</strong> al completarse la entrega.`;

            // Update impact bar if available
            if (window.__updateImpactBar) window.__updateImpactBar();

            // Disable main button
            btnEcoBtn.textContent = '‚úÖ Env√≠oEco activado';
            btnEcoBtn.disabled = true;
            btnEcoBtn.style.opacity = .7;
            btnEcoBtn.style.cursor = 'default';
        }
    </script>

</body>

</html>
<script>
    // Coordenadas de ejemplo (Madrid)
    const lat = 40.4168;
    const lng = -3.7038;

    // Crear mapa
    const map = L.map('map').setView([lat, lng], 12);

    // Cargar mapa base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '¬© OpenStreetMap'
    }).addTo(map);

    // Marcador
    L.marker([lat, lng])
        .addTo(map)
        .bindPopup("Ubicaci√≥n aproximada del env√≠o.")
        .openPopup();

  // ====== Configuraci√≥n de la barra de impacto ======
  // Rango m√°ximo visible en la barra (kg CO2e)
  const CO2_MAX = 10;

  // Valores iniciales (puedes sustituir por datos reales)
  let co2Actual = 4.8;   // kg CO2e en modo Est√°ndar
  const ahorroPorc = 40; // % ahorro al pasar a ECO

  // Elementos del DOM
  const bar        = document.querySelector('.impact-bar');
  const barFill    = document.getElementById('impact-fill');
  const co2ValueEl = document.getElementById('co2-value');
  const savingEl   = document.getElementById('saving-percent');
  const noteEl     = document.getElementById('impact-note');
  const btnEco     = document.getElementById('btn-eco');

  // Inicializa textos
  savingEl.textContent = ahorroPorc.toString();

  // Funci√≥n para animar n√∫mero (ej. 4.8 -> 2.9)
  function animateNumber(el, from, to, duration = 600) {
    const start = performance.now();
    function tick(now) {
      const p = Math.min(1, (now - start) / duration);
      const value = from + (to - from) * p;
      el.textContent = value.toFixed(1);
      if (p < 1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  }

  // Funci√≥n para actualizar barra y accesibilidad
  function updateBar(valueKg) {
    const pct = Math.max(0, Math.min(100, (valueKg / CO2_MAX) * 100));
    barFill.style.width = pct + '%';
    bar.setAttribute('aria-valuenow', valueKg.toFixed(1));
  }

  // Estado inicial
  co2ValueEl.textContent = co2Actual.toFixed(1);
  updateBar(co2Actual);

  // Al pulsar "Cambiar a Env√≠oEco" ‚Äî sincroniza la barra de impacto
  const btnEco2 = document.getElementById('btn-eco');
  if (btnEco2) {
    btnEco2.addEventListener('click', () => {
      // La barra se actualiza cuando el usuario confirma (ver confirmEco())
    });
  }

  // Funci√≥n auxiliar expuesta para que confirmEco() actualice la barra
  window.__updateImpactBar = function() {
      if (!selectedDays) return;
      const savingPct = Math.min(40 + (selectedDays - 2) * 2, 55);
      const nuevoValor = +(co2Actual * (1 - savingPct / 100)).toFixed(1);
      bar.classList.add('eco');
      animateNumber(co2ValueEl, co2Actual, nuevoValor, 700);
      updateBar(nuevoValor);
      noteEl.innerHTML = 'Has activado <strong>Env√≠oEco</strong>. Emisiones reducidas aproximadamente un ' + savingPct + '%.';
  };
</script>
