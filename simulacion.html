<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Env√≠oEco ‚Äì Impacto CO‚ÇÇ</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;600;800;900&display=swap" rel="stylesheet"/>
<style>
  :root {
    --red:#D40511; --yellow:#FFCC00;
    --green:#2e7d32; --green2:#4caf50; --green3:#a5d6a7;
    --dark:#080808; --panel:#101010; --border:#1e1e1e; --txt:#f0f0f0; --muted:#555;
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  html,body{width:100%;height:100%;overflow:hidden;}
  body{background:var(--dark);color:var(--txt);font-family:'DM Sans',sans-serif;display:flex;flex-direction:column;}

  /* header */
  .hdr{background:var(--yellow);padding:10px 28px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
  .hdr-logo{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--red);letter-spacing:1px;}
  .hdr-title{font-size:13px;font-weight:800;color:#111;}
  .hdr-sub{font-size:10px;color:#666;}
  .hdr-right{display:flex;align-items:center;gap:10px;}
  .day-pill{font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:1px;color:#555;background:#fff;border-radius:20px;padding:4px 14px;}
  .btn-play{background:var(--red);color:#fff;border:none;cursor:pointer;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;padding:9px 28px;border-radius:6px;transition:opacity .2s;}
  .btn-play:hover:not(:disabled){opacity:.85;}
  .btn-play:disabled{opacity:.4;cursor:default;}
  .btn-reset{background:transparent;color:#555;border:1.5px solid #444;cursor:pointer;font-size:11px;font-weight:700;padding:8px 14px;border-radius:6px;}
  .btn-reset:hover{color:#fff;border-color:#fff;}

  /* layout */
  .main{flex:1;display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr auto;overflow:hidden;}

  /* sides */
  .side{display:flex;flex-direction:column;overflow:hidden;border-right:1px solid var(--border);}
  .side:last-of-type{border-right:none;}
  .side-hdr{padding:10px 18px;flex-shrink:0;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;}
  .side-hdr.lhdr{background:rgba(212,5,17,.1);}
  .side-hdr.rhdr{background:rgba(46,125,50,.12);}
  .side-badge{font-size:9px;font-weight:800;letter-spacing:.8px;text-transform:uppercase;padding:2px 9px;border-radius:20px;flex-shrink:0;}
  .side-badge.r{background:var(--red);color:#fff;}
  .side-badge.g{background:var(--green);color:#fff;}
  .side-title{font-size:12px;font-weight:800;}
  .side-desc{font-size:9px;color:var(--muted);}
  .side-scroll{flex:1;overflow-y:auto;padding:12px 16px;scrollbar-width:thin;scrollbar-color:var(--border) transparent;}

  /* day row */
  .drow{margin-bottom:10px;opacity:0;transition:opacity .3s;}
  .drow.show{opacity:1;}
  .dname{font-size:9px;font-weight:800;letter-spacing:.5px;text-transform:uppercase;color:var(--muted);margin-bottom:5px;display:flex;align-items:center;gap:5px;}
  .dname::after{content:'';flex:1;border-top:1px solid var(--border);}

  /* trucks */
  .t-track{display:flex;flex-wrap:wrap;gap:6px;min-height:44px;align-items:flex-start;}
  .tcard{display:flex;flex-direction:column;align-items:center;gap:2px;background:var(--panel);border:1px solid var(--border);border-radius:8px;padding:5px 7px;opacity:0;transform:scale(.7);transition:opacity .35s,transform .35s cubic-bezier(.175,.885,.32,1.275);}
  .tcard.pop{opacity:1;transform:scale(1);}
  .tcard.rc{border-color:var(--red);}
  .tcard.gc{border-color:var(--green2);}
  .temoji{font-size:22px;line-height:1;}
  .tsmoke{font-size:10px;min-height:13px;}
  .spuff{display:inline-block;opacity:0;}
  .spuff.emit{animation:smoke 1.6s ease-out forwards;}
  @keyframes smoke{0%{opacity:.7;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-10px) scale(1.6);}}
  .tlabel{font-size:9px;font-weight:700;}
  .tlabel.rl{color:var(--red);}
  .tlabel.gl{color:var(--green2);}

  /* pending */
  .parea{background:#0e0e0e;border:1px dashed #222;border-radius:7px;padding:6px 9px;min-height:34px;display:flex;flex-wrap:wrap;gap:3px;align-items:center;}
  .plabel{font-size:9px;font-weight:800;letter-spacing:.3px;text-transform:uppercase;color:#2a2a2a;width:100%;margin-bottom:3px;}
  .pdot{font-size:13px;opacity:0;transition:opacity .2s,transform .2s;transform:scale(.3);}
  .pdot.show{opacity:1;transform:scale(1);}
  .pdot.gone{opacity:.1;transform:scale(.8);}

  /* bottom bar */
  .bbar{grid-column:1/-1;border-top:1px solid var(--border);background:#0b0b0b;padding:12px 20px;display:grid;grid-template-columns:1fr 1fr;gap:14px;flex-shrink:0;}
  .mgroup{display:flex;gap:10px;}
  .metric{flex:1;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:9px 12px;position:relative;overflow:hidden;}
  .ml{font-size:9px;font-weight:800;letter-spacing:.5px;text-transform:uppercase;color:var(--muted);}
  .mv{font-family:'Bebas Neue',sans-serif;font-size:30px;letter-spacing:1px;line-height:1.1;transition:color .3s;}
  .ms{font-size:9px;color:var(--muted);}
  .metric.rm .mv{color:var(--red);}
  .metric.gm .mv{color:var(--green2);}
  .mfill{position:absolute;bottom:0;left:0;width:100%;height:3px;}
  .mfill.rf{background:var(--red);}
  .mfill.gf{background:var(--green2);}

  /* co2 streak */
  .streak{position:fixed;top:62px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.9);border:1px solid var(--green);border-radius:30px;padding:5px 18px;font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:1px;color:var(--green2);white-space:nowrap;opacity:0;transition:opacity .3s;z-index:50;pointer-events:none;}
  .streak.show{opacity:1;}

  /* final overlay */
  .fover{position:fixed;inset:0;background:rgba(0,0,0,.93);display:none;align-items:center;justify-content:center;z-index:100;cursor:pointer;}
  .fover.show{display:flex;animation:fin .5s ease;}
  @keyframes fin{from{opacity:0}to{opacity:1}}
  .fcard{background:linear-gradient(150deg,#0d1f0d,#090909);border:2px solid var(--green);border-radius:20px;padding:36px 50px;max-width:800px;width:92%;text-align:center;animation:fpop .5s cubic-bezier(.175,.885,.32,1.275);}
  @keyframes fpop{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
  .ftitle{font-family:'Bebas Neue',sans-serif;font-size:38px;letter-spacing:2px;color:var(--green2);margin-bottom:4px;}
  .fsub{font-size:13px;color:#777;margin-bottom:26px;}
  .fnums{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:22px;}
  .fn{background:#0c1e0c;border:1px solid var(--green);border-radius:12px;padding:18px 14px;}
  .fnl{font-size:9px;font-weight:800;letter-spacing:.6px;text-transform:uppercase;color:var(--green3);}
  .fnv{font-family:'Bebas Neue',sans-serif;font-size:48px;letter-spacing:1px;color:#fff;line-height:1;}
  .fns{font-size:11px;color:var(--green2);font-weight:700;margin-top:2px;}
  .fequiv{background:#111;border:1px solid #1e1e1e;border-radius:10px;padding:12px 18px;font-size:12px;color:#999;line-height:1.7;}
  .fequiv strong{color:var(--green2);}
  .fhint{font-size:10px;color:#333;margin-top:16px;}
</style>
</head>
<body>

<div class="hdr">
  <div style="display:flex;align-items:center;gap:12px;">
    <div class="hdr-logo">HackatonDHL</div>
    <div>
      <div class="hdr-title">Env√≠oEco ‚Äî Simulaci√≥n de impacto medioambiental</div>
      <div class="hdr-sub">7 d√≠as ¬∑ Zona 28931 ¬∑ 72 paquetes simulados</div>
    </div>
  </div>
  <div class="hdr-right">
    <div class="day-pill" id="dpill">D√çA 0 / 7</div>
    <button class="btn-reset" onclick="resetSim()">‚Ü∫ Reiniciar</button>
    <button class="btn-play" id="bplay" onclick="startSim()">‚ñ∂ INICIAR</button>
  </div>
</div>

<div class="main">
  <div class="side">
    <div class="side-hdr lhdr">
      <span class="side-badge r">SITUACI√ìN ACTUAL</span>
      <div>
        <div class="side-title">Sin Env√≠oEco</div>
        <div class="side-desc">Un cami√≥n cada d√≠a ¬∑ sin consolidar ¬∑ siempre a media carga</div>
      </div>
    </div>
    <div class="side-scroll" id="lscroll"></div>
  </div>

  <div class="side">
    <div class="side-hdr rhdr">
      <span class="side-badge g">CON ENV√çOECO</span>
      <div>
        <div class="side-title">Algoritmo de consolidaci√≥n</div>
        <div class="side-desc">Acumula paquetes ¬∑ sale el cami√≥n cuando la ruta es rentable</div>
      </div>
    </div>
    <div class="side-scroll" id="rscroll"></div>
  </div>

  <div class="bbar">
    <div class="mgroup">
      <div class="metric rm">
        <div class="ml">üöõ Camiones (actual)</div>
        <div class="mv" id="lt">0</div>
        <div class="ms">rutas lanzadas</div>
        <div class="mfill rf"></div>
      </div>
      <div class="metric rm">
        <div class="ml">‚òÅÔ∏è CO‚ÇÇ (actual)</div>
        <div class="mv" id="lc">0 kg</div>
        <div class="ms">emisiones acumuladas</div>
        <div class="mfill rf"></div>
      </div>
    </div>
    <div class="mgroup">
      <div class="metric gm">
        <div class="ml">üöõ Camiones (Env√≠oEco)</div>
        <div class="mv" id="rt">0</div>
        <div class="ms">rutas lanzadas</div>
        <div class="mfill gf"></div>
      </div>
      <div class="metric gm">
        <div class="ml">üåø CO‚ÇÇ (Env√≠oEco)</div>
        <div class="mv" id="rc">0 kg</div>
        <div class="ms">emisiones acumuladas</div>
        <div class="mfill gf"></div>
      </div>
    </div>
  </div>
</div>

<div class="streak" id="streak">üåø CO‚ÇÇ ahorrado: 0 kg</div>

<div class="fover" id="fover" onclick="this.classList.remove('show')">
  <div class="fcard">
    <div class="ftitle">üåø Impacto de Env√≠oEco en 7 d√≠as</div>
    <div class="fsub">Zona 28931 ¬∑ 72 paquetes ¬∑ OptimizadorEcoPuntosFinal</div>
    <div class="fnums">
      <div class="fn">
        <div class="fnl">Rutas ahorradas</div>
        <div class="fnv" id="fn1">‚Äî</div>
        <div class="fns" id="fn1s">menos camiones</div>
      </div>
      <div class="fn">
        <div class="fnl">CO‚ÇÇ evitado</div>
        <div class="fnv" id="fn2">‚Äî</div>
        <div class="fns" id="fn2s">kg de emisiones</div>
      </div>
      <div class="fn">
        <div class="fnl">Reducci√≥n total</div>
        <div class="fnv" id="fn3">‚Äî</div>
        <div class="fns">de las emisiones</div>
      </div>
    </div>
    <div class="fequiv" id="fequiv"></div>
    <div class="fhint">Toca para cerrar</div>
  </div>
</div>

<script>
const DAYS       = 7;
const DAY_NAMES  = ['Lun 25 feb','Mar 26 feb','Mi√© 27 feb','Jue 28 feb','Vie 1 mar','S√°b 2 mar','Dom 3 mar'];
const DAILY_PKGS = [8,11,7,14,9,13,10]; // 72 total
const CO2_TRUCK  = 12;   // kg CO‚ÇÇ per truck
const THRESHOLD  = 22;   // min pkgs to fire eco route
const STEP_MS    = 1500; // delay between days
const TRUCK_CAP  = 50;

let timer=null, curDay=0, running=false;
const L={t:0,co2:0}, R={t:0,co2:0,pending:0,dots:[]};

function animNum(id,val,suf=''){
  const el=document.getElementById(id); if(!el)return;
  const from=parseFloat(el.textContent)||0;
  const t0=performance.now();
  (function tick(now){
    const p=Math.min(1,(now-t0)/500);
    el.textContent=Math.round(from+(val-from)*p)+suf;
    if(p<1)requestAnimationFrame(tick);
  })(performance.now());
}

function scroll(id){ const e=document.getElementById(id); if(e)setTimeout(()=>e.scrollTop=e.scrollHeight,80); }

function makeTruck(containerId, pkgs, side){
  const wrap=document.getElementById(containerId); if(!wrap)return;
  const green=side==='r';
  const nSmoke=pkgs<=15?1:pkgs<=30?2:3;
  const card=document.createElement('div');
  card.className=`tcard ${green?'gc':'rc'}`;
  const smokes=[...Array(nSmoke)].map(()=>`<span class="spuff">üí®</span>`).join('');
  card.innerHTML=`<div class="temoji">üöõ</div><div class="tsmoke">${smokes}</div><div class="tlabel ${green?'gl':'rl'}">${pkgs} pkgs ¬∑ ${pkgs<=15?'bajo':pkgs<=30?'medio':'lleno'}</div>`;
  wrap.appendChild(card);
  requestAnimationFrame(()=>{ card.offsetHeight; card.classList.add('pop'); });
  setTimeout(()=>card.querySelectorAll('.spuff').forEach((s,i)=>setTimeout(()=>s.classList.add('emit'),i*200)),400);
}

function makeLeftDay(d,pkgs){
  const div=document.createElement('div'); div.className='drow'; div.id=`ld${d}`;
  div.innerHTML=`<div class="dname">${DAY_NAMES[d]} ¬∑ +${pkgs} paquetes</div><div class="t-track" id="lt${d}"></div>`;
  document.getElementById('lscroll').appendChild(div);
  requestAnimationFrame(()=>div.classList.add('show'));
}

function makeRightDay(d,pkgs){
  const div=document.createElement('div'); div.className='drow'; div.id=`rd${d}`;
  div.innerHTML=`<div class="dname">${DAY_NAMES[d]} ¬∑ +${pkgs} paquetes</div><div class="parea" id="rp${d}"><div class="plabel" id="rpl${d}">en cola</div></div><div class="t-track" id="rt${d}" style="margin-top:5px"></div>`;
  document.getElementById('rscroll').appendChild(div);
  requestAnimationFrame(()=>div.classList.add('show'));
}

function addDots(d,count){
  const area=document.getElementById(`rp${d}`); if(!area)return;
  for(let i=0;i<count;i++){
    const dot=document.createElement('span'); dot.className='pdot'; dot.textContent='üì¶';
    area.appendChild(dot); R.dots.push(dot);
    setTimeout(()=>{ dot.offsetHeight; dot.classList.add('show'); },i*45);
  }
}

function clearDots(){
  R.dots.forEach(d=>{ d.classList.remove('show'); d.classList.add('gone'); });
  R.dots=[];
}

function updateStreak(){
  const saved=L.co2-R.co2; if(saved<=0)return;
  const el=document.getElementById('streak');
  el.textContent=`üåø CO‚ÇÇ ahorrado hasta ahora: ${saved} kg`;
  el.classList.add('show');
}

function stepDay(d){
  const pkgs=DAILY_PKGS[d];
  document.getElementById('dpill').textContent=`D√çA ${d+1} / ${DAYS}`;
  const isLast=d===DAYS-1;

  // LEFT
  makeLeftDay(d,pkgs);
  setTimeout(()=>{
    makeTruck(`lt${d}`,pkgs,'l');
    L.t++; L.co2+=CO2_TRUCK;
    animNum('lt',L.t); animNum('lc',L.co2,' kg');
    scroll('lscroll'); updateStreak();
  },300);

  // RIGHT
  makeRightDay(d,pkgs);
  R.pending+=pkgs;
  setTimeout(()=>{
    addDots(d,pkgs);
    const fire=R.pending>=THRESHOLD||isLast;
    if(fire){
      const batch=R.pending; const nT=Math.ceil(batch/TRUCK_CAP); R.pending=0;
      setTimeout(()=>{
        clearDots();
        const lbl=document.getElementById(`rpl${d}`);
        if(lbl)lbl.textContent=`üöÄ Enviando ${batch} paquetes juntos`;
        for(let t=0;t<nT;t++){
          const cnt=t<nT-1?TRUCK_CAP:batch-t*TRUCK_CAP;
          setTimeout(()=>{
            makeTruck(`rt${d}`,cnt,'r');
            R.t++; R.co2+=CO2_TRUCK;
            animNum('rt',R.t); animNum('rc',R.co2,' kg');
            updateStreak();
          },t*320);
        }
        scroll('rscroll');
        if(isLast)setTimeout(showFinal,nT*320+1200);
      },600);
    } else {
      const lbl=document.getElementById(`rpl${d}`);
      if(lbl)lbl.textContent=`‚è≥ Acumulando‚Ä¶ ${R.pending} en cola`;
      scroll('rscroll');
      if(isLast)setTimeout(showFinal,1200);
    }
  },500);
}

function showFinal(){
  const sT=L.t-R.t, sCO2=L.co2-R.co2, pct=Math.round(sCO2/L.co2*100);
  document.getElementById('fn1').textContent=sT;
  document.getElementById('fn1s').textContent=`‚àí${Math.round(sT/L.t*100)}% de rutas en la calle`;
  document.getElementById('fn2').textContent=sCO2+' kg';
  document.getElementById('fn2s').textContent=`de ${L.co2} kg totales sin Env√≠oEco`;
  document.getElementById('fn3').textContent=pct+'%';
  const trees=Math.round(sCO2/21), km=Math.round(sCO2/0.12);
  document.getElementById('fequiv').innerHTML=
    `<strong>${sCO2} kg de CO‚ÇÇ evitados</strong> equivalen a plantar <strong>${trees} √°rboles</strong> `+
    `o a no conducir <strong>${km.toLocaleString('es-ES')} km</strong> en coche &mdash; solo en <strong>una semana</strong> y en <strong>una zona postal</strong>.`;
  document.getElementById('streak').classList.remove('show');
  document.getElementById('fover').classList.add('show');
}

function startSim(){
  if(running)return; running=true;
  document.getElementById('bplay').disabled=true;
  function next(){ if(curDay>=DAYS)return; stepDay(curDay++); if(curDay<DAYS)timer=setTimeout(next,STEP_MS); }
  next();
}

function resetSim(){
  clearTimeout(timer); running=false; curDay=0;
  L.t=0;L.co2=0; R.t=0;R.co2=0;R.pending=0;R.dots=[];
  document.getElementById('lscroll').innerHTML='';
  document.getElementById('rscroll').innerHTML='';
  document.getElementById('bplay').disabled=false;
  document.getElementById('dpill').textContent='D√çA 0 / 7';
  document.getElementById('streak').classList.remove('show');
  document.getElementById('fover').classList.remove('show');
  ['lt','rt'].forEach(id=>document.getElementById(id).textContent='0');
  ['lc','rc'].forEach(id=>document.getElementById(id).textContent='0 kg');
}
</script>
</body>
</html>