<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>EnvÃ­oEco â€“ SimulaciÃ³n</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;600;800;900&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root{
  --red:#D40511;--yellow:#FFCC00;
  --green:#2e7d32;--green2:#4caf50;--green3:#a5d6a7;
  --blue:#1565c0;--blue2:#42a5f5;
  --dark:#ffffff;--panel:#f5f5f5;--panel2:#efefef;--border:#d0d0d0;
  --txt:#111111;--muted:#777;--muted2:#555;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{width:100%;height:100%;overflow:hidden;}
body{background:var(--dark);color:var(--txt);font-family:'DM Sans',sans-serif;display:flex;flex-direction:column;}

/* â”€â”€ HEADER â”€â”€ */
.hdr{background:var(--yellow);padding:9px 28px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.hdr-logo{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--red);letter-spacing:1px;}
.hdr-title{font-size:13px;font-weight:800;color:#111;}
.hdr-sub{font-size:10px;color:#666;}
.hdr-right{display:flex;align-items:center;gap:8px;}
.day-pill{font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:1px;color:#555;background:#fff;border-radius:20px;padding:3px 12px;}
.btn-sm{background:transparent;color:#555;border:1.5px solid #888;cursor:pointer;font-size:11px;font-weight:700;padding:7px 13px;border-radius:6px;transition:all .2s;}
.btn-sm:hover{color:#111;border-color:#111;}

/* â”€â”€ PAGE â”€â”€ */
.page{flex:1;overflow:hidden;display:flex;flex-direction:column;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUSINESS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.biz-page{background:var(--dark);overflow-y:auto;padding:20px 28px;}

/* KPI row */
.kpi-row{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:20px;}
.kpi{background:var(--panel2);border:1px solid var(--border);border-radius:12px;padding:14px 16px;position:relative;overflow:hidden;}
.kpi::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;}
.kpi.kred::before{background:var(--red);}
.kpi.kgrn::before{background:var(--green2);}
.kpi.kyel::before{background:var(--yellow);}
.kpi.kblu::before{background:var(--blue2);}
.kpi-label{font-size:9px;font-weight:800;letter-spacing:.6px;text-transform:uppercase;color:var(--muted2);margin-bottom:6px;}
.kpi-val{font-family:'Bebas Neue',sans-serif;font-size:34px;letter-spacing:1px;line-height:1;}
.kpi-val.red{color:var(--red);}
.kpi-val.grn{color:var(--green2);}
.kpi-val.yel{color:var(--yellow);}
.kpi-val.blu{color:var(--blue2);}
.kpi-sub{font-size:10px;color:var(--muted);margin-top:3px;}
.kpi-delta{font-size:11px;font-weight:800;margin-top:4px;}
.kpi-delta.up{color:var(--green2);}
.kpi-delta.dn{color:var(--red);}

/* Charts grid */
.charts-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;margin-bottom:20px;}
.charts-grid.bottom{grid-template-columns:1fr 1fr;}
.chart-card{background:var(--panel2);border:1px solid var(--border);border-radius:12px;padding:16px 18px;}
.chart-title{font-size:11px;font-weight:800;letter-spacing:.5px;text-transform:uppercase;color:var(--muted2);margin-bottom:14px;display:flex;align-items:center;gap:7px;}
.chart-title .ct-badge{font-size:9px;padding:2px 8px;border-radius:10px;font-weight:800;}
.ct-badge.grn{background:rgba(76,175,80,.15);color:var(--green2);}
.ct-badge.red{background:rgba(212,5,17,.12);color:var(--red);}
.ct-badge.yel{background:rgba(255,204,0,.12);color:#d4a017;}
.chart-wrap{position:relative;}

/* ROI table */
.roi-table{width:100%;border-collapse:collapse;font-size:11px;margin-top:6px;}
.roi-table thead th{padding:7px 10px;text-align:left;font-size:9px;font-weight:800;letter-spacing:.5px;text-transform:uppercase;color:var(--muted);border-bottom:1px solid var(--border);}
.roi-table tbody td{padding:8px 10px;border-bottom:1px solid #e0e0e0;color:var(--txt);}
.roi-table tbody tr:hover{background:#f0f0f0;}
.roi-table .good{color:var(--green2);font-weight:800;}
.roi-table .bad{color:var(--red);font-weight:700;}
.roi-table .neutral{color:var(--yellow);font-weight:700;}

/* Scenario selector */
.scenario-bar{display:flex;align-items:center;gap:10px;margin-bottom:18px;}
.scenario-bar label{font-size:11px;font-weight:800;color:var(--muted2);letter-spacing:.4px;text-transform:uppercase;}
.scen-btn{background:var(--panel2);border:1px solid var(--border);color:var(--muted2);font-size:11px;font-weight:700;padding:6px 16px;border-radius:20px;cursor:pointer;transition:all .2s;}
.scen-btn.active{background:var(--yellow);color:#111;border-color:var(--yellow);}
.scen-btn:hover:not(.active){border-color:var(--txt);color:var(--txt);}
</style>
</head>
<body>

<!-- HEADER -->
<div class="hdr">
  <div style="display:flex;align-items:center;gap:12px;">
    <a href="index.html" class="hdr-logo" style="text-decoration:none;">DHL</a>
    <div>
      <div class="hdr-title">EnvÃ­oEco â€” SimulaciÃ³n de impacto</div>
      <div class="hdr-sub">7 dÃ­as Â· Zona 28931 Â· 72 paquetes</div>
    </div>
  </div>

</div>



<!-- â•â• BUSINESS PAGE â•â• -->
<div class="page active" id="page-biz">
  <div class="biz-page" id="biz-scroll">

    <!-- Scenario selector -->
    <div class="scenario-bar">
      <label>Escenario:</label>
      <button class="scen-btn active" onclick="setScenario('week',this)">1 semana</button>
      <button class="scen-btn" onclick="setScenario('month',this)">1 mes</button>
      <button class="scen-btn" onclick="setScenario('year',this)">1 aÃ±o</button>
    </div>

    <!-- KPIs -->
    <div class="kpi-row">
      <div class="kpi kred">
        <div class="kpi-label">Coste actual (sin Eco)</div>
        <div class="kpi-val red" id="kpi-cost-before">420â‚¬</div>
        <div class="kpi-sub" id="kpi-cost-before-sub">7 rutas Ã— 60â‚¬</div>
      </div>
      <div class="kpi kgrn">
        <div class="kpi-label">Coste con EnvÃ­oEco</div>
        <div class="kpi-val grn" id="kpi-cost-after">180â‚¬</div>
        <div class="kpi-sub" id="kpi-cost-after-sub">3 rutas Ã— 60â‚¬</div>
        <div class="kpi-delta up" id="kpi-cost-delta">â–¼ âˆ’57% de coste</div>
      </div>
      <div class="kpi kyel">
        <div class="kpi-label">Ahorro neto</div>
        <div class="kpi-val yel" id="kpi-saving">240â‚¬</div>
        <div class="kpi-sub" id="kpi-saving-sub">en la semana simulada</div>
      </div>
      <div class="kpi kgrn">
        <div class="kpi-label">COâ‚‚ evitado</div>
        <div class="kpi-val grn" id="kpi-co2">48 kg</div>
        <div class="kpi-sub" id="kpi-co2-sub">â‰ˆ 57% menos emisiones</div>
      </div>
      <div class="kpi kblu">
        <div class="kpi-label">OcupaciÃ³n media camiÃ³n</div>
        <div class="kpi-val blu" id="kpi-fill">72%</div>
        <div class="kpi-sub" id="kpi-fill-sub">vs 20% sin algoritmo</div>
        <div class="kpi-delta up">â–² +52 puntos</div>
      </div>
    </div>

    <!-- 3 charts top -->
    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-title">ğŸ“¦ Rutas lanzadas
          <span class="ct-badge red">Actual vs Eco</span>
        </div>
        <div class="chart-wrap" style="height:180px"><canvas id="ch-routes"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">â˜ï¸ Emisiones COâ‚‚ acumuladas
          <span class="ct-badge grn">DÃ­a a dÃ­a</span>
        </div>
        <div class="chart-wrap" style="height:180px"><canvas id="ch-co2line"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">ğŸ’¶ DistribuciÃ³n del coste
          <span class="ct-badge yel">Desglose</span>
        </div>
        <div class="chart-wrap" style="height:180px"><canvas id="ch-pie"></canvas></div>
      </div>
    </div>

    <!-- 2 charts bottom -->
    <div class="charts-grid bottom">
      <div class="chart-card">
        <div class="chart-title">ğŸ“ˆ Coste logÃ­stico acumulado
          <span class="ct-badge red">Actual</span>
          <span class="ct-badge grn">EnvÃ­oEco</span>
        </div>
        <div class="chart-wrap" style="height:160px"><canvas id="ch-cost"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">ğŸ­ ROI por zona postal â€” proyecciÃ³n mensual</div>
        <table class="roi-table">
          <thead>
            <tr>
              <th>Zona</th>
              <th>Rutas ahorradas</th>
              <th>Ahorro â‚¬/mes</th>
              <th>COâ‚‚ evitado</th>
              <th>ROI</th>
            </tr>
          </thead>
          <tbody id="roi-tbody"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script src="dashboard-stats.js"></script>

<script>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUSINESS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentScenario='week';
let charts={};

// â”€â”€ Build SCENARIOS from real dashboard-stats.js data (con histÃ³rico) â”€â”€
const _wk=DASHBOARD_STATS;
const _wkDays=7;
const _wkCo2L=_wk.graficos.emisionesDiarias.acumuladoActual.slice(-1)[0]; // 84
const _wkCo2R=_wk.graficos.emisionesDiarias.acumuladoEco.slice(-1)[0];    // 36
const _wkCostL=_wk.kpis.costeActual;  // 420
const _wkCostR=_wk.kpis.costeEco;     // 163.8

// Proyecciones reales del algoritmo
const _hM=_wk.historicoProyecciones.find(h=>h.periodo==='1 Mes');
const _hY=_wk.historicoProyecciones.find(h=>h.periodo==='1 AÃ±o');

// Mes: coste total derivado del ritmo diario real + ahorro real del algoritmo
const _mCostL=Math.round((_wkCostL/_wkDays)*_hM.dias);          // 1800
const _mCostR=Math.round(_mCostL-_hM.ahorroEuros);               // 702
const _mCo2L =Math.round((_wkCo2L/_wkDays)*_hM.dias);           // 360
const _mCo2R =Math.round(_mCo2L-_hM.co2EvitadoKg);              // 206
const _mRoutesL=Math.round((_wk.graficos.rutasLanzadas.sinEco/_wkDays)*_hM.dias); // 30
const _mRoutesR=Math.round((_wk.graficos.rutasLanzadas.conEco/_wkDays)*_hM.dias); // 13

// AÃ±o: Ã­dem con datos reales anuales del algoritmo
const _yCostL=Math.round((_wkCostL/_wkDays)*_hY.dias);           // 21900
const _yCostR=Math.round(_yCostL-_hY.ahorroEuros);               // 8895
const _yCo2L =Math.round((_wkCo2L/_wkDays)*_hY.dias);           // 4380
const _yCo2R =Math.round(_yCo2L-_hY.co2EvitadoKg);              // 2393
const _yRoutesL=Math.round((_wk.graficos.rutasLanzadas.sinEco/_wkDays)*_hY.dias); // 365
const _yRoutesR=Math.round((_wk.graficos.rutasLanzadas.conEco/_wkDays)*_hY.dias); // 157

const SCENARIOS={
  week:{
    label:'1 semana Â· 1 zona', mult:1,
    paquetes:_wk.historicoProyecciones.find(h=>h.periodo==='1 Semana').paquetesOptimizados,
    routesL:_wk.graficos.rutasLanzadas.sinEco,
    routesR:_wk.graficos.rutasLanzadas.conEco,
    co2L:_wkCo2L, co2R:_wkCo2R,
    costL:_wkCostL, costR:_wkCostR,
    fillL:_wk.kpis.porcentajeOcupacionSinEco,
    fillR:_wk.kpis.porcentajeOcupacionConEco,
    days:_wk.graficos.emisionesDiarias.dias,
    co2ByDayL:_wk.graficos.emisionesDiarias.acumuladoActual,
    co2ByDayR:_wk.graficos.emisionesDiarias.acumuladoEco,
    costByDayL:_wk.graficos.costeDiario.acumuladoActual,
    costByDayR:_wk.graficos.costeDiario.acumuladoEco,
  },
  month:{
    label:'1 mes Â· 1 zona', mult:_hM.dias/_wkDays,
    paquetes:_hM.paquetesOptimizados,
    routesL:_mRoutesL, routesR:_mRoutesR,
    co2L:_mCo2L, co2R:_mCo2R,
    costL:_mCostL, costR:_mCostR,
    fillL:_wk.kpis.porcentajeOcupacionSinEco,
    fillR:_wk.kpis.porcentajeOcupacionConEco,
    days:['S1','S2','S3','S4'],
    co2ByDayL:[_mCo2L/4,_mCo2L/2,_mCo2L*3/4,_mCo2L].map(Math.round),
    co2ByDayR:[_mCo2R/4,_mCo2R/2,_mCo2R*3/4,_mCo2R].map(Math.round),
    costByDayL:[_mCostL/4,_mCostL/2,_mCostL*3/4,_mCostL].map(Math.round),
    costByDayR:[_mCostR/4,_mCostR/2,_mCostR*3/4,_mCostR].map(Math.round),
  },
  year:{
    label:'1 aÃ±o Â· 1 zona', mult:_hY.dias/_wkDays,
    paquetes:_hY.paquetesOptimizados,
    routesL:_yRoutesL, routesR:_yRoutesR,
    co2L:_yCo2L, co2R:_yCo2R,
    costL:_yCostL, costR:_yCostR,
    fillL:_wk.kpis.porcentajeOcupacionSinEco,
    fillR:_wk.kpis.porcentajeOcupacionConEco,
    days:['T1','T2','T3','T4'],
    co2ByDayL:[_yCo2L/4,_yCo2L/2,_yCo2L*3/4,_yCo2L].map(Math.round),
    co2ByDayR:[_yCo2R/4,_yCo2R/2,_yCo2R*3/4,_yCo2R].map(Math.round),
    costByDayL:[_yCostL/4,_yCostL/2,_yCostL*3/4,_yCostL].map(Math.round),
    costByDayR:[_yCostR/4,_yCostR/2,_yCostR*3/4,_yCostR].map(Math.round),
  }
};

function fmt(n){
  if(n>=1000000)return(n/1000000).toFixed(1)+'M';
  if(n>=1000)return(n/1000).toFixed(0)+'K';
  return n.toString();
}

function setScenario(key,btn){
  currentScenario=key;
  document.querySelectorAll('.scen-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  buildBizPage(key);
}

function buildBizPage(key){
  const s=SCENARIOS[key];
  const saving=s.costL-s.costR;
  const savingPct=Math.round((saving/s.costL)*100);
  const co2Saved=s.co2L-s.co2R;
  const co2Pct=Math.round((co2Saved/s.co2L)*100);

  // KPIs
  document.getElementById('kpi-cost-before').textContent=fmt(s.costL)+'â‚¬';
  document.getElementById('kpi-cost-before-sub').textContent=`${fmt(s.routesL)} rutas Ã— 60â‚¬`;
  document.getElementById('kpi-cost-after').textContent=fmt(s.costR)+'â‚¬';
  document.getElementById('kpi-cost-after-sub').textContent=`${fmt(s.routesR)} rutas Ã— 60â‚¬`;
  document.getElementById('kpi-cost-delta').textContent=`â–¼ âˆ’${savingPct}% de coste`;
  document.getElementById('kpi-saving').textContent=fmt(saving)+'â‚¬';
  document.getElementById('kpi-saving-sub').textContent=`${s.label} Â· ${s.paquetes} paquetes optimizados`;
  document.getElementById('kpi-co2').textContent=fmt(co2Saved)+' kg';
  document.getElementById('kpi-co2-sub').textContent=`â‰ˆ ${co2Pct}% menos emisiones`;
  document.getElementById('kpi-fill').textContent=s.fillR+'%';
  document.getElementById('kpi-fill-sub').textContent=`vs ${s.fillL}% sin algoritmo`;

  // ROI table â€” real data for week, scaled for month/year
  const _roi=DASHBOARD_STATS.tablaRoi;
  const zones=_roi.map(z=>({
    zona:z.zona,
    rAh:z.rutasAhorradas*s.mult,
    eur:z.ahorroEuros*s.mult,
    co2:Math.abs(z.co2Evitado)*s.mult,
    roi:z.roi
  }));

  document.getElementById('roi-tbody').innerHTML=zones.map(z=>`
    <tr>
      <td>${z.zona}</td>
      <td class="${z.roi==='Alto'?'good':'neutral'}">${fmt(z.rAh)} menos</td>
      <td class="good">+${fmt(z.eur)}â‚¬</td>
      <td class="good">âˆ’${fmt(z.co2)} kg</td>
      <td class="${z.roi==='Alto'?'good':'neutral'}">${z.roi==='Alto'?'â­ Alto':'âœ“ Medio'}</td>
    </tr>`).join('');

  drawCharts(s);
}

const CHART_DEFAULTS={
  plugins:{legend:{labels:{color:'#555',font:{family:'DM Sans',size:10}}}},
  scales:{
    x:{grid:{color:'#e0e0e0'},ticks:{color:'#777',font:{size:9}}},
    y:{grid:{color:'#e0e0e0'},ticks:{color:'#777',font:{size:9}}}
  }
};

function destroyChart(key){if(charts[key]){charts[key].destroy();delete charts[key];}}

function drawCharts(s){
  // 1. BAR: routes
  destroyChart('routes');
  charts['routes']=new Chart(document.getElementById('ch-routes'),{
    type:'bar',
    data:{
      labels:['Sin EnvÃ­oEco','Con EnvÃ­oEco'],
      datasets:[{
        label:'Rutas',
        data:[s.routesL,s.routesR],
        backgroundColor:['rgba(212,5,17,.75)','rgba(76,175,80,.75)'],
        borderColor:['#D40511','#4caf50'],
        borderWidth:2,borderRadius:6,
      }]
    },
    options:{...CHART_DEFAULTS,responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},
        tooltip:{callbacks:{label:ctx=>`${ctx.raw} rutas lanzadas`}}
      }
    }
  });

  // 2. LINE: CO2 acumulado dÃ­a a dÃ­a
  destroyChart('co2line');
  const labels2=s.days;
  charts['co2line']=new Chart(document.getElementById('ch-co2line'),{
    type:'line',
    data:{
      labels:labels2,
      datasets:[
        {label:'Actual',data:s.co2ByDayL,borderColor:'#D40511',backgroundColor:'rgba(212,5,17,.08)',tension:.4,pointRadius:3,fill:true},
        {label:'EnvÃ­oEco',data:s.co2ByDayR,borderColor:'#4caf50',backgroundColor:'rgba(76,175,80,.1)',tension:.4,pointRadius:3,fill:true},
      ]
    },
    options:{...CHART_DEFAULTS,responsive:true,maintainAspectRatio:false,
      plugins:{legend:{labels:{color:'#555',font:{size:10}}}}
    }
  });

  // 3. PIE: cost breakdown
  destroyChart('pie');
  const saving=s.costL-s.costR;
  charts['pie']=new Chart(document.getElementById('ch-pie'),{
    type:'doughnut',
    data:{
      labels:['Coste evitado (ahorro)','Coste necesario (EnvÃ­oEco)'],
      datasets:[{
        data:[saving,s.costR],
        backgroundColor:['rgba(76,175,80,.8)','rgba(255,204,0,.7)'],
        borderColor:['#4caf50','#FFCC00'],
        borderWidth:2,hoverOffset:6,
      }]
    },
    options:{responsive:true,maintainAspectRatio:false,cutout:'65%',
      plugins:{
        legend:{position:'bottom',labels:{color:'#555',font:{size:9},boxWidth:10}},
        tooltip:{callbacks:{label:ctx=>`${fmt(ctx.raw)}â‚¬ (${Math.round(ctx.raw/s.costL*100)}%)`}}
      }
    }
  });

  // 4. LINE: coste acumulado
  destroyChart('cost');
  charts['cost']=new Chart(document.getElementById('ch-cost'),{
    type:'line',
    data:{
      labels:s.days,
      datasets:[
        {label:'Actual',data:s.costByDayL,borderColor:'#D40511',backgroundColor:'rgba(212,5,17,.07)',tension:.4,pointRadius:3,fill:true},
        {label:'EnvÃ­oEco',data:s.costByDayR,borderColor:'#4caf50',backgroundColor:'rgba(76,175,80,.08)',tension:.4,pointRadius:3,fill:true},
      ]
    },
    options:{...CHART_DEFAULTS,responsive:true,maintainAspectRatio:false,
      plugins:{legend:{labels:{color:'#555',font:{size:10}}},
        tooltip:{callbacks:{label:ctx=>`${fmt(ctx.raw)}â‚¬`}}
      }
    }
  });
}

// Init biz page on load
buildBizPage('week');
</script>
</body>
</html>